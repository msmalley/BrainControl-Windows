var config;var buttons;var blockchain;var braincontrol;var bc_settings;var bc_starting_panel;var bc_alerts;var vals="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";var positions={};for(var i=0;i<vals.length;++i){positions[vals[i]]=i}var address_types={prod:"00",testnet:"6f"};var p2sh_types={prod:"05",testnet:"c4"};var base=new function(){this.compatible=function(e){try{var t=base.get("options");if(t)return true;base.set("options",e);return true}catch(n){return false}};this.really_compatible=function(e){try{localStorage.setItem("bc.temp",JSON.stringify({test:"testing"}));return localStorage["bc.temp"]}catch(t){return false}};this.lang=function(e){return e};this.is_json=function(e){try{if(e)JSON.parse(e);else return false}catch(t){return false}return true};this.set=function(e,t){localStorage.setItem("bc."+e,JSON.stringify(t))};this.get=function(e){if(this.is_json(localStorage["bc."+e])){return $.parseJSON(localStorage["bc."+e])}else if(localStorage["bc."+e]){return localStorage["bc."+e]}return false};this.update=function(e,t,n){var r=this.get(e);r[t]=n;this.set(e,r)};this.reset=function(){this.set("accounts",null);this.set("contacts",null);this.set("templates",null);this.set("stats",null);this.set("alert",null);this.set("alerts",null);this.set("salt",null)};this.alert=function(e,t){if(t){var n=base.get("alert");var r=base.get("alerts");var i=e.replace(/\W/g,"");var s=i.toLowerCase();if(!r)r=new Object;if(bc_alerts&&bc_alerts[s]||n&&r[s])return false;else if(!bc_alerts){bc_alerts=new Object;if(n!="once"){alert(base.lang("Please note that since you are using this on a small screen, any text hidden from your particular view will be alerted to you once per session."));if(confirm(base.lang("Clicking cancel below will show this text during each session - click OK for them to only ever be shown once."))){base.set("alert","once");bc_alerts[s]=base.lang(e);r[s]=base.lang(e);base.set("alerts",r);alert(base.lang(e))}}else{bc_alerts[s]=base.lang(e);r[s]=base.lang(e);base.set("alerts",r);alert(base.lang(e))}}else{bc_alerts[s]=base.lang(e);var o=base.get("alert");if(o=="once"){r[s]=base.lang(e);base.set("alerts",r)}alert(base.lang(e))}}else{alert(base.lang(e))}};this.endian=function(e){var t=[];for(var n=e.length;n>0;n-=2){t.push(e.substring(n-2,n))}return t.join("")}};config=new function(){this.defaults=function(){var e={id:"braincontrol",name:"BrainControl",salt:"braincontrolmesalt",stats:[{id:"dashboard-usd",fact:base.lang("BTC to USD"),figure:base.lang("loading")},{id:"dashboard-24tx",fact:base.lang("Daily Transactions"),figure:base.lang("loading")},{id:"dashboard-24sent",fact:base.lang("Daily BTC Sent"),figure:base.lang("loading")},{id:"dashboard-hash",fact:base.lang("Hash Rate GH/s"),figure:base.lang("loading")},{id:"dashboard-found",fact:base.lang("BTC Discovered"),figure:base.lang("loading")},{id:"dashboard-cap",fact:base.lang("Market Cap USD"),figure:base.lang("loading")}],ux:{pin:{title:base.lang("Pin<span>Confirmation</span>"),intro:base.lang("For those that are extra paranoid, use a 6 digit PIN number for extra security.")},calculator:{title:base.lang("BTC<span>Calculator</span>"),placeholder:base.lang("Convert from USD to BTC")},qr:{title:base.lang("QR<span>Code</span>"),h6:base.lang("Address")},profile:{title:base.lang("Important<span>Settings</span>")},buttons:{loading:base.lang("Loading!"),recover:base.lang("Recover Lost BC Accounts"),backup:base.lang("Backup"),print_key:base.lang("Print Key"),print_address:base.lang("Print Address"),send:base.lang("Send"),clear:base.lang("Clear"),notes:base.lang("Notes"),scan:base.lang("Scan OR Import QR Code - Beta"),qr:base.lang("QR"),new_in:base.lang("Generate New Wallet"),new_contact:base.lang("Add New Contact"),reset:base.lang("Reset Device"),import_keys:base.lang("Import Keys"),recover:base.lang("Recover Lost Account")},info:{salt:base.lang("A salt is another unique identifier for creating and restoring wallets. It's default value is stored on the device, but you can also override the value for each individual wallet should you prefer.")}},forms:{send:[{paragraph:[{text:base.lang("Send Bitcoin from one of your wallets to any known address using the following form"),classes:"unessential"}]},{id:"type",value:"send_payment"},{id:"to",label:base.lang("To"),type:"text",placeholder:base.lang("BTC Address"),icon:[{href:"#",id:"bc-select-contact",img:"user"}]},{id:"from",label:base.lang("From"),select:{options:[]}},{id:"fee",label:base.lang("Fee"),type:"text",placeholder:base.lang("0.0001 Min"),value:1e-4},{id:"amount",label:base.lang("Amount"),type:"text",placeholder:base.lang("BTC to Send")},{id:"submit",value:base.lang("Send"),type:"submit",classes:"bc-block bc-button bc-primary bc-submit"},{id:"password"},{id:"salt"},{id:"pin"}]},panels:[],app:{header:{left:{href:"#",direction:"right",id:"step-calculator",icon:"bc-calculator"},right:{href:"#",direction:"left",id:"step-profile",icon:"bc-profile"},title:base.lang("Brain<span>Control</span>")},nav:[{href:"#",classes:"bc-slide active",id:"page-markets",icon:"bc-markets",text:"Markets"},{href:"#",classes:"bc-slide",id:"page-accounts",icon:"bc-accounts",text:"Accounts"},{href:"#",classes:"bc-slide",id:"page-send",icon:"bc-send",text:"Send"},{href:"#",classes:"bc-slide",id:"page-contacts",icon:"bc-contacts",text:"Contacts"}]}};return e};this.settings=function(e){var t=e.salt;var n=base.get("salt");if(n)t=n;bc_starting_point={id:"step-setup",top:{buttons:[{href:"#",classes:"bc-block bc-icon bc-primary bc-slide",text:base.lang("setup your device now"),after:base.lang("this is a live working version"),icon:"chevron-circle-right",direction:"left",id:"step-start"}]},middle:{icon:"check-circle",warning:base.lang("This device is compatible")},bottom:{text:base.lang("It only takes a minute to setup your Bitcoin wallet. No need to download additional software or have a Bitcoin node installed.")}};e.panels.push(bc_starting_point);e.panels.push({id:"step-start",top:{text:base.lang("Important<span>Warning</span>"),close:true},middle:{paragraphs:[{text:base.lang("Since this is the first time you have visited this application using this browser (or have somehow re-set your LocalStorage) - you will first need to configure the application.")},{text:base.lang("The application uses a combination of salts, label names and passwords to generate inline deterministc key-pairs.")},{text:base.lang("The private keys are NOT stored on ANY device so re-entering the passwords is frequently required and important.")},{text:base.lang("The application uses BlockChain.info to ascertain market values, account balanaces and relaying the raw transactions."),classes:"unessential"}]},bottom:{buttons:[{href:"#",classes:"bc-block bc-icon bc-action bc-slide",text:base.lang("understood"),icon:"chevron-circle-right",direction:"left",id:"step-id"}]}});e.panels.push({id:"step-id",top:{text:base.lang("Your<span>Identity</span>"),close:true},middle:{text:base.lang("If you forget your passwords and names, or change then lose salts; you will not be able to access wallets that are not backed-up."),form:[{id:"type",value:"new_id"},{id:"salt",type:"text",label:base.lang("Device Salt"),value:t,placeholder:base.lang("A memorable salt is required!"),icon:"info-circle",icons:[{icon:"info-circle"}]},{id:"name",type:"text",label:base.lang("Account Name")},{id:"password",type:"password",label:base.lang("Passphrase")},{id:"password_repeat",type:"password",label:base.lang("Repeat")},{id:"pin",classes:"pin_number"}]},bottom:{buttons:[{href:"#",classes:"bc-icon bc-action bc-half bc-pin bc-slide",text:base.lang("add pin"),icon:"plus-circle",direction:"up",id:"step-pin",back_direction:"down",back_id:"step-id"},{href:"#",classes:"bc-primary bc-half bc-submit",text:base.lang("submit")}]}});e.panels.push({id:"step-new",top:{text:base.lang("New<span>Wallet</span>"),close:true},middle:{text:base.lang("If you forget your passwords and names, or change then loose salts; you will not be able to access wallets that are not backed-up."),form:[{id:"type",value:"new_id"},{id:"name",type:"text",label:base.lang("Account Name")},{id:"password",type:"password",label:base.lang("Passphrase")},{id:"password_repeat",type:"password",label:base.lang("Repeat")},{id:"salt",type:"text",label:base.lang("Extra Salt"),value:t,placeholder:base.lang("A memorable salt is required!"),icon:"info-circle",icons:[{icon:"info-circle"}]},{id:"pin",classes:"pin_number"}]},bottom:{buttons:[{href:"#",classes:"bc-icon bc-action bc-half bc-pin bc-slide",text:base.lang("add pin"),icon:"plus-circle",direction:"up",id:"step-pin",back_direction:"down",back_id:"step-id"},{href:"#",classes:"bc-primary bc-half bc-submit",text:base.lang("submit")}]}});e.panels.push({id:"step-recover",top:{text:base.lang("Recover<span>Account</span>"),close:[{direction:"down",id:"step-profile"}]},middle:{text:base.lang("This allows you to import / re-create accounts created at other domains."),form:[{id:"type",value:"recover_accounts"},{id:"name",type:"text",label:base.lang("Account Name")},{id:"password",type:"password",label:base.lang("Passphrase")},{id:"password_repeat",type:"password",label:base.lang("Repeat")},{id:"salt",type:"text",label:base.lang("Salt Used"),placeholder:base.lang("The original salt"),icon:"info-circle",icons:[{icon:"info-circle"}]},{id:"url",type:"text",label:base.lang("URL Used"),placeholder:base.lang("Where was the original wallet?")},{id:"pin",classes:"pin_number"}]},bottom:{buttons:[{href:"#",classes:"bc-icon bc-action bc-half bc-pin bc-slide",text:base.lang("add pin"),icon:"plus-circle",direction:"up",id:"step-pin",back_direction:"down",back_id:"step-recover"},{href:"#",classes:"bc-primary bc-half bc-submit",text:base.lang("submit")}]}});e.panels.push({id:"step-import",top:{text:base.lang("Import<span>Keys</span>"),close:[{direction:"down",id:"step-profile"}]},middle:{form:[{id:"type",value:"import_keys"},{id:"key",type:"text",label:base.lang("Private Key")},{id:"name",type:"text",label:base.lang("Account Name")},{id:"password",type:"password",label:base.lang("Passphrase")},{id:"password_repeat",type:"password",label:base.lang("Repeat")},{id:"salt",type:"text",label:base.lang("Desired Salt"),classes:"unessential",value:t,icon:"info-circle",icons:[{icon:"info-circle"}]},{id:"pin",classes:"pin_number"}],paragraphs:[{text:base.lang("This allows you to import private keys generated from any device or service. Please note it uses the device salt when importing."),classes:"unessential"},{text:base.lang("Please also note in order to import the keys to this device we actually have to transfer the ocntents from that account to a new one created during the import process with a network transaction fee of 0.0001."),classes:"unessential"}]},bottom:{buttons:[{href:"#",classes:"bc-icon bc-action bc-half bc-pin bc-slide",text:base.lang("add pin"),icon:"plus-circle",direction:"up",id:"step-pin",back_direction:"down",back_id:"step-import"},{href:"#",classes:"bc-primary bc-half bc-submit",text:base.lang("submit")}]}});e.panels.push({id:"step-contact",top:{text:base.lang("New<span>Contact</span>"),close:true},middle:{text:base.lang("You can add contacts here then re-use them when sending payments. Add additional details using the notes button below."),form:[{id:"type",value:"new_contact"},{id:"name",type:"text",label:base.lang("Contact Name")},{id:"address",type:"text",label:base.lang("BTC Address")},{id:"tel"},{id:"email"},{id:"notes"}]},bottom:{buttons:[{href:"#",classes:"bc-icon bc-action bc-half bc-notes bc-slide",text:base.lang("notes"),icon:"plus-circle",direction:"up",id:"step-notes",back_direction:"down",back_id:"step-contact"},{href:"#",classes:"bc-primary bc-half bc-submit",text:base.lang("submit")}]}});e.panels.push({id:"step-notes",top:{text:base.lang("Contact<span>Info</span>"),close:true},middle:{form:[{id:"type",value:"contact_info"},{id:"email",type:"text",label:base.lang("Email")},{id:"tel",type:"text",label:base.lang("Telephone")},{id:"notes",label:base.lang("Extra Notes"),textarea:true}]}});e.panels.push({id:"step-note",top:{text:base.lang("Contact<span>Info</span>"),close:[{direction:"false",id:"page-contacts"}]},middle:{form:[{id:"email",type:"text",label:base.lang("Email")},{id:"tel",type:"text",label:base.lang("Telephone")},{id:"notes",label:base.lang("Extra Notes"),textarea:true}]},bottom:{buttons:[{href:"#",classes:"bc-primary bc-block bc-submit",text:base.lang("Save")}]}});e.panels.push({id:"step-confirm",top:{text:base.lang("Confirm<span>Details</span>"),close:[{direction:"false",id:"page-accounts"}]},middle:{form:[{id:"type",value:"confirm_details"},{id:"username"},{id:"password",type:"password",label:base.lang("Passphrase")},{id:"salt",type:"text",label:base.lang("Extra Salt"),value:t},{id:"pin",classes:"pin_number"}]},bottom:{buttons:[{href:"#",classes:"bc-icon bc-action bc-half bc-pin bc-slide hidden",text:base.lang("add pin"),icon:"plus-circle",direction:"up",id:"step-pin",back_direction:"down",back_id:"step-confirm"},{href:"#",classes:"bc-primary bc-half bc-submit",text:base.lang("Confirm")}]}});e.panels.push({id:"step-confirm-send",top:{text:base.lang("Confirm<span>Send</span>"),close:[{direction:"false",id:"page-send"}]},middle:{form:[{paragraph:[{text:base.lang('Sending <span class="btc">0</span> BTC (worth <span class="usd">0</span> USD) and paying a <span class="fee">0</span> USD Transaction Fee to the Network...?'),classes:"unessential"}]},{id:"type",value:"confirm_send"},{id:"password",type:"password",label:base.lang("Passphrase")},{id:"salt",type:"text",label:base.lang("Extra Salt"),value:t},{id:"pin",classes:"pin_number"},{id:"username"}]},bottom:{buttons:[{href:"#",classes:"bc-icon bc-action bc-half bc-pin bc-slide",text:base.lang("add pin"),icon:"plus-circle",direction:"up",id:"step-pin",back_direction:"down",back_id:"step-confirm-send"},{href:"#",classes:"bc-primary bc-half bc-submit",text:base.lang("Confirm")}]}});return e}};blockchain=new function(){this.balance=function(e,t){this.query("addressbalance",e,0,t)};this.query=function(e,t,n,r){var i="https://blockchain.info/q/"+e+"/"+t;if(!t||t=="false"){i="https://blockchain.info/q/"+e}if(!n)n=0;if(n)i+="?confirmations="+n;$.ajax({url:i,success:function(e){r(e)}})};this.balances=function(e){var t=base.get("accounts");var n=(new Date).getTime();$("#braincontrol-holder #page-accounts .account .btc").each(function(e){var r=$(this);var i=$(r).attr("data-address");var s=$(r).attr("data-username");var o=t[s];if(o){var u=o.ts;var a=u+6e4;var f=parseFloat(o.btc*1e8);if(n>a){blockchain.balance(i,function(e){var i=parseFloat(e/1e7);$(r).text(i);t[s].btc=i;t[s].ts=n;base.set("accounts",t);if(e>f){var o=parseFloat((e-f)/1e8);base.alert(base.lang("Incoming Payment of "+o+" BTC Received"))}})}}})}};var PRIVATE_KEY_VERSION=128;btc=new function(){this.keys=function(e,t){var n=Crypto.SHA256(e);var r=Crypto.util.hexToBytes(n);var i=new Bitcoin.ECKey(r);var s=t||n;var o=false;try{var u=getSECCurveByName("secp256k1");var a=u.getG().multiply(i.priv);i.pub=this.encode(a,false);i.pubKeyHash=Bitcoin.Util.sha256ripe160(i.pub);var f=i.getBitcoinAddress();var l=new Bitcoin.Address(r);l.version=128;var c=this.encrypt(n+","+f+","+l,s);o={result:1,secret:n,pubkey:f,privkey:l,payload:c,payload_hash:Crypto.SHA256(c),response:"keys generated"}}catch(h){o={result:0,error:h,response:base.lang("Invalid secret exponent (must be non-zero value)")}}return o};this.encrypt=function(e,t){return""+CryptoJS.AES.encrypt(e,Crypto.SHA256(t))};this.encode=function(e,t){var n=e.getX().toBigInteger();var r=e.getY().toBigInteger();var i=integerToBytes(n,32);if(t){if(r.isEven()){i.unshift(2)}else{i.unshift(3)}}else{i.unshift(4);i=i.concat(integerToBytes(r,32))}return i};this.decode=function(e){var t=BigInteger.valueOf(58);var n=e.length;var r=BigInteger.valueOf(0);var i=0;var s=false;for(var o=0;o<n;++o){var u=e[o];var a=positions[u];if(a===undefined){throw new Error("invalid base58 string: "+e)}r=r.multiply(t).add(BigInteger.valueOf(a));if(u=="1"&&!s){++i}else{s=true}}var f=r.toByteArrayUnsigned();while(i-->0){f.unshift(0)}return f};this.check=function(e){var t=this.decode(e);var n=t.slice(0,t.length-4);var r=t.slice(t.length-4);var i=Crypto.SHA256(Crypto.SHA256(n,{asBytes:true}),{asBytes:true}).slice(0,4);if(""+i!=""+r){throw new Error("Checksum failed")}var s=n.slice(1);s.version=n[0];return s};this.validate=function(e){try{this.check(e);return true}catch(t){return false}};this.raw=function(e,t,n,r,i,s){var o=Bitcoin.Base58.decode(t).slice(1,33);var u=new Bitcoin.ECKey(o);var a=0;var f=0;var l=0;if(i)a=i;if(s)l=s;TX.init(u);$.each(n,function(e,t){f+=t.value;var n={txid:t.txid,n:t.n,script:t.script,value:t.value*1};TX.addInputs(n,TX.getAddress())});$.each(r,function(e,t){TX.addOutput(r[e].address,parseFloat(r[e].value))});if(f>l+a){var c=f-(l+a);TX.addOutput(e,parseFloat(c/1e8).toFixed(8))}var h=TX.construct();return Crypto.util.bytesToHex(h.serialize())};this.unspent=function(e,t){var n="https://blockchain.info/unspent?active="+e;var r=true;if(r){var i='select * from html where url="'+n+'"';n="https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(i)}$.ajax({url:n,dataType:"XML",success:function(e){var n=$(e).find("results").text();if(!n){base.alert(base.lang("No available funds / error connecting - please try again"));braincontrol.unload()}else if(n=="No free outputs to spend"){base.alert(n);braincontrol.unload()}else{if(base.is_json(n)){var r=JSON.parse(n);if(!r.unspent_outputs){t(r)}else{t(r.unspent_outputs)}}else{base.alert(base.lang("Error fetching unspent"));braincontrol.unload()}}},error:function(e,t,n){console.log(n)}})};this.convert=function(e){var t=Bitcoin.Base58.decode(e).slice(1,33);var n=new Bitcoin.ECKey(t);return n.getBitcoinAddress().toString()}};buttons=new function(){this.defaults=function(e){$("#"+e.id).on("click",".fake-input",function(e){this.setSelectionRange(0,9999);e.preventDefault();e.stopPropagation()});$("#"+e.id).on("click","#bc-recover-account",function(t){t.preventDefault();$("#"+e.id).find("#step-recover .bc-form #name").val("");$("#"+e.id).find("#step-recover .bc-form #password").val("");$("#"+e.id).find("#step-recover .bc-form #password_repeat").val("");$("#"+e.id).find("#step-recover .bc-form #salt").val("");$("#"+e.id).find("#step-recover .bc-form #url").val("");$("#"+e.id).find("#step-recover .bc-form #pin").val("")});$("#"+e.id).on("click","#bc-new-wallet",function(t){t.preventDefault();$("#"+e.id).find("#step-new .bc-form #name").val("");$("#"+e.id).find("#step-new .bc-form #password").val("");$("#"+e.id).find("#step-new .bc-form #password_repeat").val("");$("#"+e.id).find("#step-new .bc-form #pin").val("")});$("#"+e.id).on("click","#bc-new-contact",function(t){t.preventDefault();$("#"+e.id).find("#step-contact .bc-form #name").val("");$("#"+e.id).find("#step-contact .bc-form #address").val("");$("#"+e.id).find("#step-contact .bc-form #tel").val("");$("#"+e.id).find("#step-contact .bc-form #email").val("");$("#"+e.id).find("#step-contact .bc-form #notes").val("")});$("#"+e.id).on("click","#bc-import-keys",function(t){t.preventDefault();$("#"+e.id).find("#step-import .bc-form #name").val("");$("#"+e.id).find("#step-import .bc-form #password").val("");$("#"+e.id).find("#step-import .bc-form #password_repeat").val("");$("#"+e.id).find("#step-import .bc-form #key").val("");$("#"+e.id).find("#step-import .bc-form #pin").val("")});$("#"+e.id).on("click","#step-confirm-send .bc-submit",function(t){t.preventDefault();braincontrol.load();var n=$("#"+e.id).find("#step-confirm-send .bc-form #password").val();var r=$("#"+e.id).find("#step-confirm-send .bc-form #salt").val();var i=$("#"+e.id).find("#step-confirm-send .bc-form #pin").val();$("#"+e.id).find("#page-send .bc-form #password").val(n);$("#"+e.id).find("#page-send .bc-form #salt").val(r);$("#"+e.id).find("#page-send .bc-form #pin").val(i);braincontrol.slide(false,"page-send",function(){var t=$("#"+e.id).find("#page-send .bc-form");var n=new Object;$(t).find("input, select, textarea").each(function(e){n[$(this).attr("id")]=$(this).val()});if(n.to){var r=base.get("accounts");var i=r[n.from];var s=i.username;var o=parseFloat(i.btc)*1e8;if(i.address)n.from=i.address}if(n.from&&!btc.validate(n.from))base.alert(base.lang("Valid Address Required"));else if(!n.to)base.alert(base.lang("To Address Required"));else if(!n.salt)base.alert(base.lang("Missing Salts"));else if(!n.password)base.alert(base.lang("Password Required"));else if(!n.from)base.alert(base.lang("From Address Required"));else if(!n.fee||parseFloat(n.fee)<1e-4)base.alert(base.lang("Minimum 0.0001 Fee Required"));else if(!n.amount||parseFloat(n.amount)<1e-6)base.alert(base.lang("Minimum 0.000001 Transaction Required"));if(!n.to||!n.password||!n.from||!n.fee||parseFloat(n.fee)<1e-4||!n.amount||parseFloat(n.amount)<1e-6){braincontrol.unload();return false}else{if(Crypto.SHA256(n.password)!=i.pw){base.alert(base.lang("Password Mismatch!"));braincontrol.unload();return false}else if(Crypto.SHA256(n.salt)!=i.salt){base.alert(base.lang("Salt Mismatch!"));braincontrol.unload();return false}else if(Crypto.SHA256(n.pin)!=i.pin){base.alert(base.lang("Pin Mismatch!"));braincontrol.unload();return false}var u=base.get("url");if(i.url)u=i.url;var a=btc.keys(Crypto.SHA256(n.salt+u+Crypto.SHA256(s+n.password+n.pin)));var f=a.pubkey.toString();if(f!=i.address){base.alert(base.lang("Unknown error!"));braincontrol.unload()}else{btc.unspent(i.address,function(t){var i=parseFloat(n.fee)*1e8;var u=parseFloat(n.amount)*1e8;var l=0;var c=[];var h=[];h.push({address:n.to,value:n.amount});$.each(t,function(e,t){if(!t["tx_hash"]){l+=parseFloat(t["out"][t["in"][0].prev_out.n].value);c.push({txid:t.hash,n:t["in"][0].prev_out.n,value:parseFloat(t["out"][t["in"][0].prev_out.n].value),script:t["in"][0].scriptSig})}else{l+=parseFloat(t.value);c.push({txid:base.endian(t.tx_hash),n:t.tx_output_n,value:parseFloat(t.value),script:t.script})}});if(u>l+i){base.alert(base.lang("Not enough balance - have reduced to max - please re-confirm"));braincontrol.unload();var p=l-i;$("#"+e.id).find("#page-send #amount").val(parseFloat(p/1e8))}else{var d=btc.raw(f,a.privkey.toString(),c,h,i,u);$.ajax({url:"https://blockchain.info/pushtx",data:{tx:d},dataType:"TEXT",type:"POST",complete:function(t){blockchain.balance(a.pubkey.toString(),function(t){var n=parseInt(t);braincontrol.unload();if(n!=o){var i=parseFloat(n/1e8);r[s].btc=i;$("#"+e.id).find(".btc").each(function(e){if($(this).attr("data-username")==s){$(this).text(i)}});base.set("accounts",r);base.alert(base.lang("Successfully sent"));braincontrol.slide(false,"page-accounts")}else{base.alert(base.lang("Unable to send - may have been connection issues, please try again."))}})}})}})}}})});$("#"+e.id).on("click",".bc-submit",function(t){t.preventDefault();var n=$(this);var r=base.get("salt");var i=$(this).parent().parent().find("form.bc-form");if($(this).parent().parent().hasClass("bc-form"))i=$(this).parent().parent();var s=new Object;$(i).find("input, select, textarea").each(function(e){s[$(this).attr("id")]=$(this).val()});if(s.type=="send_payment"){if(!s.to)base.alert(base.lang("To Address Required"));else if(!s.from)base.alert(base.lang("From Address Required"));else if(!s.fee||parseFloat(s.fee)<1e-4)base.alert(base.lang("Minimum 0.0001 Fee Required"));else if(!s.amount||parseFloat(s.amount)<1e-6)base.alert(base.lang("Minimum 0.000001 Transaction Required"));if(!s.to||!s.from||!s.fee||parseFloat(s.fee)<1e-4||!s.amount||parseFloat(s.amount)<1e-6){return false}else{var o=base.get("stats");var u=parseFloat(o["price"]);var a=parseFloat(s.amount*u).toFixed(2);var f=parseFloat(s.fee*u).toFixed(2);$("#"+e.id).find("#step-confirm-send .bc-form .unessential .btc").text(s.amount);$("#"+e.id).find("#step-confirm-send .bc-form .unessential .usd").text(a);$("#"+e.id).find("#step-confirm-send .bc-form .unessential .fee").text(f);$("#"+e.id).find("#step-confirm-send .bc-form #password").val("");$("#"+e.id).find("#step-confirm-send .bc-form #salt").val(r);$("#"+e.id).find("#step-confirm-send .bc-form #pin").val("");braincontrol.slide("down","step-confirm-send",function(e){})}}else if(s.type=="new_id"||s.type=="import_keys"||s.type=="recover_accounts"){var l=false;var c=base.get("salt");var h=base.get("url");if(!window.location)l="https://braincontrol.me";else if(!h&&window.location.href)l=window.location.href.substring(0,window.location.href.length-window.location.search.length);else if(!h&&!window.location.href)l="https://braincontrol.me";else if(h)l=h;if(s.type=="import_keys"&&!s.salt&&c)s.salt=c;else if(s.type=="import_keys"&&!c){base.alert(base.lang("Cannot Import - Device Salt not Set!"));return false}if(s.type=="recover_accounts"&&!s.url)base.alert(base.lang("Base URL Required"));else if(s.type=="import_keys"&&!s.key)base.alert(base.lang("Private Key Required"));else if(!s.salt)base.alert(base.lang("Salt Required"));else if(!s.name)base.alert(base.lang("Name Required"));else if(!s.password)base.alert(base.lang("Password Required"));else if(!s.password_repeat)base.alert(base.lang("Password Mismatch"));else if(s.password&&s.password_repeat&&s.password!=s.password_repeat)base.alert(base.lang("Password Mismatch"));if(!s.salt||!s.name||!s.password||s.password!=s.password_repeat||s.type=="import_keys"&&!s.key||s.type=="recover_keys"&&!s.url){return false}else if(s.password&&s.password.length<15&&confirm(base.lang("We recommend that your passphrase be 15 characters or more - click cancel to ignore this warning or OK to provide a stronger passphrase."),function(){return true})){return false}else{var p=s.name.replace(/\W/g,"");var d=p.toLowerCase();var v=base.get("accounts");if(v&&v[d]){base.alert(base.lang("This User Already Exists!"))}else{var m;var g;if(s.type=="import_keys"&&s.key){braincontrol.load();g=btc.convert(s.key);blockchain.balance(g,function(e){var t=parseInt(e);var n=parseFloat(parseInt(e)/1e8);if(n<11e-5)base.alert(base.lang("No Bitcoin to Import"));else{if(s.url)m=btc.keys(Crypto.SHA256(s.salt+s.url+Crypto.SHA256(d+s.password+s.pin)));else m=btc.keys(Crypto.SHA256(s.salt+l+Crypto.SHA256(d+s.password+s.pin)));var r=m.pubkey.toString();btc.unspent(g,function(e){var i=parseFloat(1e-4)*1e8;var o=t-i;var u=0;var a=[];var f=[];f.push({address:r,value:n-1e-4});$.each(e,function(e,t){if(!t["tx_hash"]){u+=parseFloat(t["out"][t["in"][0].prev_out.n].value);a.push({txid:t.hash,n:t["in"][0].prev_out.n,value:parseFloat(t["out"][t["in"][0].prev_out.n].value),script:t["in"][0].scriptSig})}else{u+=parseFloat(t.value);a.push({txid:base.endian(t.tx_hash),n:t.tx_output_n,value:parseFloat(t.value),script:t.script})}});var l=btc.raw(g,s.key,a,f,i,o);$.ajax({url:"https://blockchain.info/pushtx",data:{tx:l},dataType:"TEXT",type:"POST",complete:function(e){blockchain.balance(r,function(e){var t=parseInt(e);braincontrol.unload();if(t>0){var n=parseFloat(t/1e8);if(!v)var i=new Object;else i=v;i[d]={pw:Crypto.SHA256(s.password),salt:Crypto.SHA256(s.salt),pin:Crypto.SHA256(s.pin),currency:"btc",btc:n,ts:(new Date).getTime(),address:r,label:s.name,username:d};if(s.url)i[d].url=s.url;var o=i[d];o["button_backup"]=base.lang("Backup");o["button_clear"]=base.lang("Clear");o["button_qr"]=base.lang("QR");base.set("accounts",i);braincontrol.slide(false,"page-accounts");braincontrol.template("accounts",o,function(e){$("#braincontrol-holder select#from").append('<option value="'+d+'">'+s.name+"</option>");$("#braincontrol-holder #page-accounts").prepend(e);$("#braincontrol-holder #page-accounts").find(".bc-via-ajax").show(350,function(e){$(this).removeClass("bc-via-ajax");braincontrol.unload()})})}else{base.alert(base.lang("Unable to send - may have been connection issues, please try again."))}})}})})}})}else{if(s.url)m=btc.keys(Crypto.SHA256(s.salt+s.url+Crypto.SHA256(d+s.password+s.pin)));else m=btc.keys(Crypto.SHA256(s.salt+l+Crypto.SHA256(d+s.password+s.pin)));g=m.pubkey.toString();if(m&&g){braincontrol.load();blockchain.balance(g,function(t){if(!v)var n=new Object;else n=v;var r=parseFloat(parseInt(t)/1e8);n[d]={pw:Crypto.SHA256(s.password),salt:Crypto.SHA256(s.salt),pin:Crypto.SHA256(s.pin),currency:"btc",btc:r,ts:(new Date).getTime(),address:g,label:s.name,username:d};if(s.url)n[d].url=s.url;var i=n[d];i["button_backup"]=base.lang("Backup");i["button_clear"]=base.lang("Clear");i["button_qr"]=base.lang("QR");if(!c){base.set("salt",s.salt);$("#"+e.id).find("input#salt").val(s.salt)}if(!h)base.set("url",l);base.set("accounts",n);braincontrol.slide(false,"page-accounts");braincontrol.template("accounts",i,function(e){$("#braincontrol-holder select#from").append('<option value="'+d+'">'+s.name+"</option>");$("#braincontrol-holder #page-accounts").prepend(e);$("#braincontrol-holder #page-accounts").find(".bc-via-ajax").show(350,function(e){$(this).removeClass("bc-via-ajax");braincontrol.unload()})})})}}}}}else if(s.type=="new_contact"){if(!s.name)base.alert(base.lang("Name Required"));else if(!s.address)base.alert(base.lang("Address Required"));if(!s.name||!s.address){return false}else{var p=s.name.replace(/\W/g,"");var d=p.toLowerCase();var y=base.get("contacts");if(y&&y[d]){base.alert(base.lang("This Contact Already Exists!"))}else{if(!btc.validate(s.address)){base.alert(base.lang("Not a valid BTC Address!"));return false}var b=0;if(y)b=parseInt(y.length);if(y&&b>0){var w=1;var E=y.length;$.each(y,function(e,t){if(t.address==s.address){base.alert(base.lang("This Address Already Exists!"));return false}else if(w==E){braincontrol.load();if(!y)var n=new Object;else n=y;n[d]={name:s.name,address:s.address,username:d};if(s.tel)n[d].tel=s.tel;if(s.email)n[d].email=s.email;if(s.notes)n[d].notes=s.notes;var r=n[d];r["button_send"]=base.lang("Send");r["button_notes"]=base.lang("Notes");r["button_clear"]=base.lang("Clear");r["button_qr"]=base.lang("QR");base.set("contacts",n);braincontrol.slide(false,"page-contacts");braincontrol.template("contacts",r,function(e){$("#braincontrol-holder #select-bc-select-contact").append('<option value="'+s.address+'">'+s.name+"</option>");$("#braincontrol-holder #page-contacts").prepend(e);$("#braincontrol-holder #page-contacts").find(".bc-via-ajax").show(350,function(e){$(this).removeClass("bc-via-ajax");braincontrol.unload()})})}w++})}else{braincontrol.load();if(!y)var S=new Object;else S=y;S[d]={name:s.name,address:s.address,username:d};if(s.tel)S[d].tel=s.tel;if(s.email)S[d].email=s.email;if(s.notes)S[d].notes=s.notes;var x=S[d];x["button_send"]=base.lang("Send");x["button_notes"]=base.lang("Notes");x["button_clear"]=base.lang("Clear");x["button_qr"]=base.lang("QR");base.set("contacts",S);braincontrol.slide(false,"page-contacts");braincontrol.template("contacts",x,function(e){$("#braincontrol-holder #select-bc-select-contact").append('<option value="'+s.address+'">'+s.name+"</option>");$("#braincontrol-holder #page-contacts").prepend(e);$("#braincontrol-holder #page-contacts").find(".bc-via-ajax").show(350,function(e){$(this).removeClass("bc-via-ajax");braincontrol.unload()})})}}}}});$("#"+e.id).on("click",".bc-button",function(e){e.preventDefault()});$("#"+e.id).on("click","ul.keypad li a",function(t){t.preventDefault();var n=true;var r=$(this);var i=$(this).text();var s=$(this).parent().parent().parent().find("input.label-less");var o=$(s).val();var u=o.length;if($(this).parent().parent().hasClass("calculator"))n=false;if(n&&i!="Del"&&i!="OK"||!n&&i!="Del"&&i!="BTC"&&i!="USD"&&i!="ENT"&&i!="+"&&i!="-"&&i!="."){if(u<6||u<10&&!n){$(this).parent().parent().parent().find("input.label-less").val(""+o+i+"")}if(u===5&&n){var a=$("#step-pin .fancy-title a.fa").attr("data-id");$("#"+a+" form.bc-form .pin_number").val(""+o+i+"");$(this).parent().parent().parent().parent().parent().find(".step-top .fancy-title a.fa").trigger("click")}}else if(i=="+"){base.set("calc_plus",o);$(this).parent().parent().parent().find("input.label-less").val("");$("#"+e.id).find("ul.keypad.calculator li.enter").attr("data-type","calc_plus")}else if(i=="-"){base.set("calc_minus",o);$(this).parent().parent().parent().find("input.label-less").val("");$("#"+e.id).find("ul.keypad.calculator li.enter").attr("data-type","calc_minus")}else if(i=="."){if(o.indexOf(".")===-1){$(this).parent().parent().parent().find("input.label-less").val(""+o+".")}}else if(i=="ENT"){var f=$("#"+e.id).find("ul.keypad.calculator li.enter").attr("data-type");if(f=="calc_plus"){$(this).parent().parent().parent().find("input.label-less").val(parseFloat(o)+parseFloat(base.get("calc_plus")));base.get("calc_plus",null);base.get("calc_minus",null);$("#"+e.id).find("ul.keypad.calculator li.enter").attr("data-type","")}else if(f=="calc_minus"){$(this).parent().parent().parent().find("input.label-less").val(parseFloat(base.get("calc_minus"))-parseFloat(o));base.get("calc_plus",null);base.get("calc_minus",null);$("#"+e.id).find("ul.keypad.calculator li.enter").attr("data-type","")}}else if(i=="Del"){$(this).parent().parent().parent().find("input.label-less").val(""+o.slice(0,-1)+"")}else if(i=="OK"){if(u===6){var a=$("#step-pin .fancy-title a.fa").attr("data-id");$("#"+a+" form.bc-form .pin_number").val(""+o+i+"");$(this).parent().parent().parent().parent().parent().find(".step-top .fancy-title a.fa").trigger("click")}else{alert(base.lang("6 Digits Required"))}}else if(i=="BTC"){var l=0;if($(s).val())l=$(s).val();if(l){var c=1/parseFloat(base.get("stats").price);var h=parseFloat(l);var p=parseFloat(c*h).toFixed(8);$(s).val(p)}$(r).text("USD");$(s).attr("placeholder",base.lang("Convert from BTC to USD"))}else if(i=="USD"){var l=0;if($(s).val())l=$(s).val();if(l){var d=parseFloat(base.get("stats").price);var v=parseFloat(l);var m=parseFloat(d*v).toFixed(2);$(s).val(m)}$(r).text("BTC");$(s).attr("placeholder",base.lang("Convert from USD to BTC"))}});$("#"+e.id).on("click",".bc-button.bc-pin",function(e){e.preventDefault();var t=$(this).attr("data-back-direction");var n=$(this).attr("data-back-id");$("#step-pin .fancy-title a.fa").attr("data-direction",t);$("#step-pin .fancy-title a.fa").attr("data-id",n)});$("#"+e.id).on("click","#step-notes .fancy-title .fa",function(e){var t=$(this).parent().parent().parent().find("form");var n=$(t).find("#email").val();var r=$(t).find("#tel").val();var i=$(t).find("#notes").val();$("#step-contact").find("form #email").val(n);$("#step-contact").find("form #tel").val(r);$("#step-contact").find("form #notes").val(i)});$("#"+e.id).on("click",".bc-button.bc-notes",function(e){e.preventDefault();var t=$(this).attr("data-back-direction");var n=$(this).attr("data-back-id");$("#step-notes .fancy-title a.fa").attr("data-direction",t);$("#step-notes .fancy-title a.fa").attr("data-id",n)});$("#"+e.id).on("click","#bc-new-wallet",function(e){e.preventDefault();$("#step-new .bc-pin.bc-button").attr("data-back-id","step-new");$("#step-new .fancy-title a.fa").attr("data-direction","");$("#step-new .fancy-title a.fa").attr("data-id",$(this).attr("data-back-id"))});$("#"+e.id).on("click","#bc-new-contact",function(e){e.preventDefault();$("#step-notes .bc-form #email").val("");$("#step-notes .bc-form #tel").val("");$("#step-notes .bc-form #notes").val("");$("#step-contact .bc-pin.bc-button").attr("data-back-id","step-contact");$("#step-contact .fancy-title a.fa").attr("data-direction","");$("#step-contact .fancy-title a.fa").attr("data-id",$(this).attr("data-back-id"))});$("#"+e.id).on("click","#bc-reset-device",function(e){e.preventDefault();if(confirm(base.lang("Confirm device reset?"))){base.reset();location.reload()}else{base.set("templates",null)}});$("#"+e.id).on("click","#navigation a",function(e){e.preventDefault();if($(this).attr("data-id")=="page-accounts"){blockchain.balances(0)}});$("#"+e.id).on("click",".bc-slide",function(e){e.preventDefault();if(!$(this).hasClass("active")){if($(this).parent().attr("id")=="navigation"){$("#braincontrol #navigation a.bc-slide").removeClass("active");$(this).addClass("active")}else if($(this).find(".fa-bc-calculator").length>0){$("#step-calculator input#usd-to-btc").val("");$("#step-calculator .fancy-title a.fa").attr("data-id",$("#navigation a.active").attr("data-id"))}else if($(this).find(".fa-bc-profile").length>0){$("#step-profile .fancy-title a.fa").attr("data-id",$("#navigation a.active").attr("data-id"))}braincontrol.slide($(this).attr("data-direction"),$(this).attr("data-id"),$(this).attr("data-return"))}});$("#"+e.id).on("click",".bc-account-backup",function(t){t.preventDefault();var n=$(this).attr("data-username");var r=base.get("accounts");var i=base.get("salt");var s=r[n];$("#"+e.id).find("#step-confirm input#username").val(n);$("#"+e.id).find("#step-confirm input#password").val("");$("#"+e.id).find("#step-confirm input#pin").val("");if(s.pin&&s.pin!="e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"){$("#"+e.id).find("#step-confirm a.bc-pin").removeClass("hidden")}else{$("#"+e.id).find("#step-confirm a.bc-pin").addClass("hidden")}if(s.salt&&s.salt==Crypto.SHA256(i)){$("#"+e.id).find("#step-confirm input#salt").parent().hide()}else{$("#"+e.id).find("#step-confirm input#salt").parent().show();$("#"+e.id).find("#step-confirm input#salt").val()}braincontrol.slide("up","step-confirm",function(e){})});$("#"+e.id).on("click","#step-qr-backups .fancy-title .fa",function(t){$("#"+e.id).find("#step-qr-backups .qr_code_title").html("");$("#"+e.id).find("#step-qr-backups .qr_code img").attr("src","")});$("#"+e.id).on("click",".bc-account-clear",function(e){e.preventDefault();var t=base.get("accounts");var n=$(this).attr("data-username");var r=$(this).parent().parent();if(confirm(base.lang("Please re-confirm that you want to remove this account before it is gone for good."))){$(r).hide(350,function(e){$(this).remove();delete t[n];$("#braincontrol-holder #send-payment select#from option").each(function(e){if($(this).attr("value")==n)$(this).remove()});base.set("accounts",t)})}});$("#"+e.id).on("click",".bc-contact-clear",function(e){e.preventDefault();var t=base.get("contacts");var n=$(this).attr("data-username");var r=$(this).attr("data-address");var i=$(this).parent().parent();if(confirm(base.lang("Please re-confirm that you want to remove this contact before it is gone for good."))){$(i).hide(350,function(e){$(this).remove();delete t[n];$("#braincontrol-holder #send-payment select#select-bc-select-contact option").each(function(e){if($(this).attr("value")==r)$(this).remove()});base.set("contacts",t)})}});$("#"+e.id).on("click",".bc-account-qr",function(e){e.preventDefault();var t=qr_code.qrcode(3,"L");var n=$(this).attr("data-address");var r=n.replace(/^[\s\u3000]+|[\s\u3000]+$/g,"");t.addData(r);t.make();$("#braincontrol #step-qr-accounts .qr_code_title").text(n);$("#braincontrol #step-qr-accounts .qr_code").html(t.createImgTag(4))});$("#"+e.id).on("click",".bc-contact-qr",function(e){e.preventDefault();var t=qr_code.qrcode(3,"L");var n=$(this).attr("data-address");var r=n.replace(/^[\s\u3000]+|[\s\u3000]+$/g,"");t.addData(r);t.make();$("#braincontrol #step-qr-contacts .qr_code_title").text(n);$("#braincontrol #step-qr-contacts .qr_code").html(t.createImgTag(4))});$("#"+e.id).on("click",".bc-contact-notes",function(t){t.preventDefault();var n=$(this).attr("data-username");if($(this).hasClass("empty")){$("#"+e.id).find("#step-note .bc-submit").attr("data-username",n)}else{var r=base.get("contacts");var i=r[n];$("#"+e.id).find("#step-note .bc-submit").attr("data-username",n);if(i){if(i.tel)$("#"+e.id).find(".bc-form #tel").val(i.tel);if(i.email)$("#"+e.id).find(".bc-form #email").val(i.email);if(i.notes)$("#"+e.id).find(".bc-form #notes").val(i.notes)}}});$("#"+e.id).on("click","#bc-select-contact",function(e){e.preventDefault();var t=$(this);$(this).hide();$(this).parent().find("input").hide(350,function(){});$(this).parent().find(".hidden-select").show(350,function(){$(this).on("change, select, blur",function(e){$(t).show();$(t).parent().find(".hidden-select").hide(350,function(e){});$(t).parent().find("input").val($(this).val()).show(350,function(e){})})})});$("#"+e.id).on("click",".bc-edit-notes",function(t){t.preventDefault();var n=$(this);var r=$("#"+e.id).find("#step-note input, #step-note textarea, #step-note label").each(function(e){$(this).removeAttr("readonly")})});$("#"+e.id).on("click","#step-profile #qr-scan-code",function(e){e.preventDefault();var n=$(this).parent().find("input.qr-scan");if(typeof MozActivity=="function"){var r=new MozActivity({name:"record"});r.onsuccess=function(){var e=window.URL.createObjectURL(this.result.blob);qrcode.callback=function(e){alert("QR Code = "+e)};qrcode.decode(t.result)}}else{$(n).trigger("click")}});$("#"+e.id).on("change","#step-profile input.qr-scan",function(e){$(this).hide();var t=e.target.files[0];try{var n=new FileReader;n.onloadend=function(e){qrcode.callback=function(e){alert("QR Code = "+e)};qrcode.decode(n.result)};n.readAsDataURL(t)}catch(e){base.alert(base.lang("This device does not support the HTML5 File Reader"))}});$("#"+e.id).on("click",".print-key",function(t){t.preventDefault();$("#"+e.id).find(".bc-panel").removeClass("printing");$("#"+e.id).find("#"+$(this).attr("data-id")).addClass("printing");window.print()});$("#"+e.id).on("click",".fancy-title .fa.fa-print",function(e){e.preventDefault();$(this).parent().parent().parent().find(".step-middle .bc-button.bc-action").trigger("click")});$("#"+e.id).on("click",".bc-contact-send",function(t){t.preventDefault();var n=$(this).attr("data-address");$("#"+e.id).find("#page-send .bc-form #to").val(n);braincontrol.slide(false,"page-send")});$("#"+e.id).on("click",".form-group .fa-info-circle",function(t){t.preventDefault();var n=$(this);var r=$(n).parent().find("input").val();var i=$(this).prev().attr("for");var s=$(n).attr("data-original");if(!s){$(n).attr("data-original",r);s=r}if(i){if(i=="salt"){if(confirm(e.ux.info[i]+base.lang(" Click OK to proceed with the default salt, or should you require something extra secure and do not have a salt of your own you can use, click cancel, and a random salt will be generated. Very secure, but also difficult to recover if you do not backup your private keys AND the salt itself, which if different to the device default is also required in order to backup the keys - so copy it to clipboard if randomly generating!"))){if(r!=s){$(n).parent().find("input").val(s)}}else{var o=Crypto.SHA256(window.location.href+"_"+(new Date).getTime());$(n).parent().find("input").val(o.slice(0,12))}}else if(e.ux.info[i]){base.alert(e.ux.info[i])}else{base.alert(base.lang("Unknown info type"))}}});$("#"+e.id).on("click","#step-note .bc-submit",function(t){t.preventDefault();var n=$("#"+e.id).find("#step-note #email").val();var r=$("#"+e.id).find("#step-note #tel").val();var i=$("#"+e.id).find("#step-note #notes").val();var s=$(this).attr("data-username");var o=base.get("contacts");if(n)o[s].email=n;if(r)o[s].tel=r;if(i)o[s].notes=i;if(n||r||i){base.set("contacts",o);$("#"+e.id).find("#step-note .fancy-title a.fa").trigger("click")}});$("#"+e.id).on("click","#step-confirm .bc-submit",function(e){e.preventDefault();var t=$("#step-confirm form.bc-form #password").val();var n=$("#step-confirm form.bc-form #salt").val();var r=$("#step-confirm form.bc-form #pin").val();var i=$("#step-confirm form.bc-form #username").val();if(i){var s=base.get("url");var o=base.get("accounts");var u=o[i];var a=u.pw;var f=u.salt;var l=u.pin;var c=u.address;if(!r)r="";if(!t)base.alert(base.lang("Password Required!"));else if(a!=Crypto.SHA256(t))base.alert(base.lang("Password Mismatch!"));else if(f!=Crypto.SHA256(n))base.alert(base.lang("Salt Mismatch!"));else if(l!=Crypto.SHA256(r))base.alert(base.lang("Pin Mismatch!"));if(!t||a!=Crypto.SHA256(t)||f!=Crypto.SHA256(n)||l!=Crypto.SHA256(r)){return false}else{braincontrol.load();if(u.url)s=u.url;var h=btc.keys(Crypto.SHA256(n+s+Crypto.SHA256(i+t+r)));var p=h.privkey.toString();var d=h.pubkey.toString();if(d==c){var v=qr_code.qrcode(3,"L");var m=p.replace(/^[\s\u3000]+|[\s\u3000]+$/g,"");v.addData(m);v.make();$("#braincontrol #step-qr-backups .qr_code_title").html(base.lang("Private Key:")+" "+p);$("#braincontrol #step-qr-backups .qr_code").html(v.createImgTag(4));braincontrol.slide("up","step-qr-backups",function(){braincontrol.unload()})}else{base.alert(base.lang("Unknown confirmation error!"));braincontrol.unload()}}}});try{var t=new FileReader}catch(n){$("#"+e.id).find("#step-profile #qr-scan-code").hide()}}};braincontrol=new function(e){this.start=function(e){if(base.compatible(e)===true){var t=false;var n=base.get("contacts");var r=base.lang("Select Contact");if(n){$.each(n,function(e,n){if(!t){t=new Array;t.push({value:"",text:r})}t.push({value:n.address,text:n.name})});e.forms.send[2].options=t}e=config.settings(e);return e}else{bc_starting_point={id:"step-setup",top:false,middle:{icon:"times-circle-o",warning:base.lang("This device is not compatible<br />localstorage required")},bottom:{buttons:[{href:"#",classes:"bc-block",text:base.lang("download via github")},{href:"#",classes:"bc-block",text:base.lang("install wordpress theme")}]}};e.panels.push(bc_starting_point);return e}};this.template=function(e,t,n){if(!t)t=braincontrol.start(config.defaults());if(base.really_compatible()){var r=base.get("markets");if(r){}var i=base.get("accounts");if(i){t["accounts"]=new Array;$.each(i,function(e,n){t["accounts"].push(n)})}var s=base.get("contacts");if(s){t["contacts"]=new Array;$.each(s,function(e,n){if(n.email||n.tel||n.notes){n.extras=new Array;n.extras.push({direction:"down",id:"step-note"})}t["contacts"].push(n)})}}var o=false;var u=base.get("templates");if(u&&u[e])o=u[e];else if(!u)u=new Object;if(o){var a=Mustache.render(o,t);n(a)}else{$.ajax({url:"html/"+e+".html",dataType:"HTML",success:function(r){var i=Mustache.render(r,t);u[e]=r;n(i);if(base.really_compatible!==false){base.set("templates",u)}}})}};this.slide=function(e,t,n){if(e==="false")e=false;if(!e){$("#braincontrol .bc-panel").each(function(e){if($(this).attr("id")=="step-calculator"){$(this).transition({left:"-150%"},350,function(e){$(this).css({"z-index":9})})}else if($(this).attr("id")=="step-profile"){$(this).transition({left:"150%"},350,function(e){$(this).css({"z-index":9})})}else{$(this).transition({top:"-150%"},350,function(e){$(this).css({"z-index":9,top:0})})}});$("#braincontrol-holder .page").css({"z-index":9});if($("#braincontrol-holder #"+t).hasClass("active")){$("#braincontrol-holder #"+t).css({"z-index":999})}else{$("#braincontrol-holder #"+t).css({"z-index":999,left:"150%",height:"100%"})}$("#braincontrol-holder #"+t).transition({left:0},350,function(e){$("#braincontrol-holder .page").removeClass("active");$(this).addClass("active");$("#braincontrol-holder .page").each(function(e){if(!$(this).hasClass("active"))$(this).css({left:"150%",height:1})});$("#navigation a").each(function(e){var n=$(this).attr("data-id");if(n==t&&!$(this).hasClass("active")){$("#navigation a").removeClass("active");$(this).addClass("active")}});$("#braincontrol #"+t).find(".unessential").each(function(e){if($(this).css("display")=="none"&&$(this).attr("id")!="salt")base.alert($(this).text(),true)});if(typeof n=="function"){n()}})}else{if(e=="up")$("#braincontrol #"+t).css({top:"150%"});else if(e=="down")$("#braincontrol #"+t).css({top:"-150%"});else if(e=="right")$("#braincontrol #"+t).css({left:"-150%"});else if(e=="left")$("#braincontrol #"+t).css({left:"150%"});$("#braincontrol #"+t).css({"z-index":9999});if(e=="up"||e=="down"){$("#braincontrol #"+t).transition({top:0},350,function(e){$("#braincontrol .bc-panel").css({"z-index":8});$("#braincontrol .bc-panel").removeClass("active");$(this).addClass("active");$(this).css({"z-index":999});$("#braincontrol #"+t).find(".unessential").each(function(e){if($(this).css("display")=="none"&&$(this).attr("id")!="salt")base.alert($(this).text(),true)});if(typeof n=="function"){n()}})}else if(e=="right"||e=="left"){$("#braincontrol #"+t).transition({left:0},350,function(e){$("#braincontrol .bc-panel").css({"z-index":8});$("#braincontrol .bc-panel").removeClass("active");$(this).addClass("active");$(this).css({"z-index":999});$("#braincontrol #"+t).find(".unessential").each(function(e){if($(this).css("display")=="none"&&$(this).attr("id")!="salt")base.alert($(this).text(),true)});if(typeof n=="function"){n()}})}}};this.load=function(){$("#braincontrol").addClass("loading");$("#braincontrol .bc-panel, #braincontrol-holder").animate({opacity:0},500,function(e){})};this.unload=function(){$("#braincontrol .bc-panel, #braincontrol-holder").animate({opacity:1},500,function(e){$("#braincontrol").removeClass("loading")})};this.dashboard=function(){if(base.compatible()){var e=0;var t=false;var n=base.get("stats");var r=(new Date).getTime();if(n&&n.ts){if(r>n.ts+108e5)t=true}if(!n||n&&(!n.price||!n.transactions||!n.sent||!n.hash||!n.found||!n.cap)||t){n=new Object;n.ts=r;blockchain.query("24hrprice",false,0,function(t){e++;var r=parseFloat(t).toFixed(2);var i=r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");$("#braincontrol-holder #page-markets #dashboard-usd .figure").text(i);n["price"]=i;if(e==6)base.set("stats",n)});blockchain.query("24hrtransactioncount",false,0,function(t){e++;var r=t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");$("#braincontrol-holder #page-markets #dashboard-24tx .figure").text(r);n["transactions"]=r;if(e==6)base.set("stats",n)});blockchain.query("24hrbtcsent",false,0,function(t){e++;var r=t/1e8;var i=parseInt(r);var s=i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");$("#braincontrol-holder #page-markets #dashboard-24sent .figure").text(s);n["sent"]=s;if(e==6)base.set("stats",n)});blockchain.query("hashrate",false,0,function(t){e++;var r=parseFloat(t*1).toFixed(0);var i=r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");$("#braincontrol-holder #page-markets #dashboard-hash .figure").text(i);n["hash"]=i;if(e==6)base.set("stats",n)});blockchain.query("totalbc",false,0,function(t){e++;var r=t/1e8;var i=parseInt(r);var s=i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");$("#braincontrol-holder #page-markets #dashboard-found .figure").text(s);n["found"]=s;if(e==6)base.set("stats",n)});blockchain.query("marketcap",false,0,function(t){e++;var r=parseFloat(t/1e9).toFixed(2);var i=""+r+" B";$("#braincontrol-holder #page-markets #dashboard-cap .figure").text(i);n["cap"]=i;if(e==6)base.set("stats",n)});braincontrol.unload()}else{e=0;r=(new Date).getTime();$("#braincontrol-holder #page-markets #dashboard-usd .figure").text(n.price);$("#braincontrol-holder #page-markets #dashboard-24tx .figure").text(n.transactions);$("#braincontrol-holder #page-markets #dashboard-24sent .figure").text(n.sent);$("#braincontrol-holder #page-markets #dashboard-hash .figure").text(n.hash);$("#braincontrol-holder #page-markets #dashboard-found .figure").text(n.found);$("#braincontrol-holder #page-markets #dashboard-cap .figure").text(n.cap);braincontrol.unload()}}braincontrol.unload()};this.forms=function(e){$("#"+e.id).find(".form-group").each(function(){$(this).find("label").on("click",function(e){e.preventDefault();if($(this).parent().find(".fa").length>0){$(this).parent().find(".fa").trigger("click")}$(this).parent().find("input").trigger("focus")})})};this.setup=function(e){$("#"+e.id).addClass("loading");braincontrol.template("base",false,function(t){$("#"+e.id).html(t).addClass("hidden");$("#"+e.id).prepend('<h1 id="loading-text">'+e.ux.buttons.loading+"</h1>");if(base.really_compatible()===false){var n=false}else{var n=base.get("accounts");if(n){$.each(n,function(e,t){$("#braincontrol #page-send select#from").prepend('<option value="'+t.username+'">'+t.label+"</option>")})}}buttons.defaults(e);braincontrol.dashboard();braincontrol.forms(e);var r=$("body").height();$("body").css({height:r});$("html").css({height:r});$("#braincontrol .bc-panel").each(function(e){var t=$(this).innerWidth();var n=$(this).find(".step-top").height()+30;var i=$(this).find(".step-bottom").height()+30;var s=r-(n+i+10);var o=$(this).find(".step-middle").height();if(o>s)$(this).find(".step-middle .unessential").hide(0,function(e){if($(this).attr("id")=="salt")$(this).parent().hide()});$(this).find(".step-middle").css({height:s,width:t})});$("#braincontrol #pages .page").each(function(e){var t=$(this).attr("id");var n=$(this).parent().height();if(t=="page-markets"){$(this).find(".stat").each(function(e){var t=($("#braincontrol-holder #page-markets").height()-110)/100*33.3;$(this).height(t)})}$(this).find("form").each(function(e){var t=$(this);var r=$(this).height();if(r>n){$(this).find(".unessential").hide(0,function(e){if($(this).attr("id")=="salt"){$(this).parent().hide()}$(t).css({"margin-top":-127})})}})});if(n){braincontrol.slide(false,"page-markets")}else{braincontrol.slide("down","step-setup")}$("#"+e.id).transition({opacity:1},350,function(e){braincontrol.unload()})})};this.init=function(){var e=braincontrol.start(config.defaults());var t=$("#"+e.id);if($(t).length>0){braincontrol.setup(e)}else{base.alert(base.lang("Cannot find associated ID"))}}};
